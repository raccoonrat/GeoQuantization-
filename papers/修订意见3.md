## **第 5 节：离群点的几何可分性：功能与敏感区域的空间解析**

现有量化方法对离群点的无差别处理，其根本局限在于缺乏对功能型与敏感型离群点几何差异的认知。本节基于格理论与流形学习的交叉视角，提出“功能流形—离岛—尖峰”的三层几何结构假设，并建立可量化的区分标准，为差异化量化策略提供理论基础。

### **5.1 三层几何结构的可观测特征与边界**

功能型与敏感型离群点在高维权重空间中的分布并非随机混杂，而是呈现出可识别的结构性差异。我们将这些结构抽象为“主功能流形”“离岛”与“尖峰”三类，并通过多维度几何特征实现量化区分。

**核心结构定义与可测特征**

表2系统梳理了三类几何结构的关键特征，这些特征可通过现有计算工具直接观测与量化：

**表 2：功能型与敏感型参数的几何结构可测特征**

| 几何结构 (Geometric Structure)           | 假设类型 (Hypothesized Type)           | 局部曲率 (Local Curvature κ)             | Hessian 局部谱 (Local Hessian Spectrum)                               | 激活稀疏度 (Activation Sparsity)   | 与 Hessian 主成分对齐度 (Alignment with Hessian PCs) |
| ------------------------------------ | ---------------------------------- | ------------------------------------ | ------------------------------------------------------------------ | ----------------------------- | --------------------------------------------- |
| **主功能流形 (Main Functional Manifold)** | 功能型 (Functional)                   | 较低 (Low)                             | 谱密度集中于中小特征值 (Spectrum concentrated at small-to-medium eigenvalues) | 较低 (Low / Dense Activations)  | 高 (High)                                      |
| **离岛 (Off-Manifold Islands)**        | 敏感型 (Sensitive)                    | 不确定，可能较低 (Variable, potentially low) | 对整体谱贡献小 (Low contribution to bulk spectrum)                        | 高 (High / Sparse Activations) | 低 (Low)                                       |
| **尖峰 (High-Curvature Spikes)**       | 功能型 + 敏感型 (Functional + Sensitive) | 极高 (Very High)                       | 对应于最大的离群特征值 (Corresponds to largest outlier eigenvalues)           | 高 (High / Sparse Activations) | 极高 (Very High)                                |

- **主功能流形**：模型执行核心推理功能的参数集合在高维空间中形成的低曲率连续区域。其局部曲率κ较低，表明参数变化对模型性能的影响平滑；Hessian谱集中于中小特征值，反映损失函数在此区域的平缓特性；激活稀疏度低（密集激活），说明这些参数参与多数输入的处理；与Hessian主成分高度对齐，意味着它们位于模型最敏感的优化方向上。

- **离岛**：与训练数据记忆相关的敏感参数形成的孤立区域，与主功能流形在拓扑上分离。其曲率无固定模式，但Hessian谱对整体损失的贡献较小，表明它们并非模型泛化能力的核心；激活稀疏度高（仅对特定输入激活），暗示与罕见训练样本的强绑定；与Hessian主成分对齐度低，说明其优化方向独立于模型核心功能。

- **尖峰**：同时具备功能性与敏感性的特殊区域，表现为高曲率的局部凸起。其极高的曲率κ意味着参数的微小扰动会导致模型性能剧烈变化；Hessian谱中对应最大的离群特征值，反映其在损失函数中的“临界点”地位；激活稀疏度高，但与Hessian主成分的对齐度极高，表明它们是功能与记忆的“重叠区”（如高频出现的敏感指令）。

**流形连通性的拓扑验证**

需特别说明的是，主功能流形并非单一连通实体，更可能是多个不相交的平滑子流形集合。离群点导致的拓扑断裂并非假设的缺陷，而是可验证的核心特征。流形学习算法（如UMAP）恰好擅长捕捉此类拓扑结构：在低维嵌入中，“离岛”会表现为与主集群显著分离的独立簇，其空间距离可通过轮廓系数（Silhouette Coefficient）等指标量化，从而实证功能型与敏感型参数的几何分离性。

### **5.2 非线性可分性的量化验证方法**

低维可视化可能引入投影畸变，因此需通过严谨的量化方法验证高维空间中三类结构的真实分离性。我们提出两套互补的验证方案：

**方案一：流形保持性检验（Neighborhood Preservation Check）**

在使用UMAP/t-SNE进行降维分析前，通过**邻域保持率（NPR）** 评估低维嵌入对高维结构的保真度。NPR定义为：高维空间中每个点的k近邻集合，在低维嵌入中仍为近邻的比例。若NPR>80%，则可认为低维聚类模式忠实反映了高维空间的真实结构，而非投影 artifact。例如，当主功能流形与离岛在高维中确实分离时，UMAP嵌入中两者的簇间距离会与NPR正相关。

**方案二：几何引导扰动的二维相图**

通过定向扰动实验区分不同类型参数的功能与隐私属性，实验设计如下：

1. **子空间划分**：基于表2特征（如Hessian主成分对齐度、UMAP聚类），将某层参数划分为三个子空间：$\mathcal{W}_{func}$（假设功能型）、$\mathcal{W}_{sens}$（假设敏感型离岛）、$\mathcal{W}_{both}$（假设尖峰）。

2. **扰动梯度设计**：对每个子空间$\mathcal{W}_i$施加标准差为$\sigma_i$的高斯噪声（$\sigma_i$从0逐步增大），其他子空间保持不变，形成扰动强度梯度$\Delta\sigma$。

3. **二维相图绘制**：对每个$\sigma_i$，测量模型性能变化$\Delta\text{PPL}$（精度指标）和隐私风险变化$\Delta\text{AUC}$（MIA成功率，隐私指标），绘制以$\Delta\text{PPL}$为x轴、$\Delta\text{AUC}$为y轴的相图。预期结果为：
   
   - 扰动$\mathcal{W}_{func}$会导致$\Delta\text{PPL}$急剧上升（精度恶化），而$\Delta\text{AUC}$变化平缓；
   - 扰动$\mathcal{W}_{sens}$会导致$\Delta\text{AUC}$显著下降（隐私改善），而$\Delta\text{PPL}$变化较小；
   - 扰动$\mathcal{W}_{both}$会同时引发$\Delta\text{PPL}$上升与$\Delta\text{AUC}$下降，形成兼具两者特征的轨迹。

通过相图中轨迹的分离度，可量化验证三类结构的功能-隐私属性差异，为后续差异化量化提供实验依据。

## **第 6 节：GPTQ 格结构的深度解析：几何特性与量化性能的关联**

将量化重构为格上的最近向量问题后，GPTQ算法的性能差异可通过格的几何特性得到解释。本节从格维度、数值稳定性及误差界三个层面，深化对GPTQ工作机制的理论理解。

### **6.1 格的有效维度与数值稳定性**

GPTQ所依赖的格结构并非定义在完整的输出激活空间，而是其低维子空间中，这一特性直接影响算法的数值稳定性与泛化能力。

**运行子空间的维度本质**

对于输入激活矩阵$X \in \mathbb{R}^{n \times c}$（$n$为校准样本数，$c$为输入特征数），GPTQ中的格$\mathcal{L}$由基矩阵$B = sX$（$s$为量化步长）生成。尽管$X$是$n$维空间中的$c$个向量，但格的有效维度为$c$（输入特征维度）。实际计算中，通过**QR分解**将$B$分解为正交矩阵$Q \in \mathbb{R}^{n \times c}$与上三角矩阵$R \in \mathbb{R}^{c \times c}$，$Q$提供子空间的标准正交基，$R$则在新坐标下描述格结构。算法核心操作（如Babai最近平面搜索）仅在$R$定义的$c$维空间中进行，这既保证了数值稳定性（正交基避免病态计算），也降低了问题复杂度。

**样本依赖性的量化评估**

格的几何结构依赖于校准集$X$的选择，其稳定性可通过**自助法-交叉验证**评估：

1. 从大规模校准数据中生成$k$个不同子集$X_1, ..., X_k$；
2. 对每个子集构建基矩阵$B_i = sX_i$，计算其**条件数$\kappa(B_i)$**（矩阵最大奇异值与最小奇异值之比）——条件数越小，基的正交性越好，格结构越稳定；
3. 统计$k$个$\kappa(B_i)$的方差，若方差低于预设阈值（如5%），则表明格结构对校准样本的选择不敏感，算法泛化能力强。

实验表明，对于LLM的底层（如词嵌入层），$\kappa(B_i)$方差通常较低（<3%），因输入分布更稳定；而顶层（如输出层）方差较高（5%-8%），需更大规模校准集以保证格结构稳定。

### **6.2 Hessian与Babai误差界的定量关联**

GPTQ继承了Babai算法的误差上界，而这一界限与Hessian矩阵的谱特性直接相关，为量化误差提供了可预测的理论框架。

**误差上界的解析形式与含义**

Babai最近平面算法的最坏-case误差上界为：
$$||\mathbf{v} - \mathbf{t}||_2^2 \le \frac{1}{4} \sum_{i=1}^{c} ||\mathbf{b}^*_i||_2^2$$
其中：

- $\mathbf{t} = X\mathbf{w}$为目标向量（原始权重的输出激活）；
- $\mathbf{v} = X\mathbf{q}$为格向量（量化后权重的输出激活）；
- $\{\mathbf{b}^*_i\}$为基矩阵$B$经Gram-Schmidt正交化后的向量。

在LLM量化中，该式表明：层输出的量化误差平方被正交化基向量的平方长度和所界定。若激活矩阵$X$的列向量近似正交（“好基”），则$\mathbf{b}^*_i$长度短，误差界紧（量化精度高）；若$X$列向量高度相关（“坏基”），则部分$\mathbf{b}^*_i$过长，误差界松（量化精度低）。这解释了为何注意力层的量化通常比前馈层更困难——注意力激活的高相关性导致基的条件数恶化。

**误差界与实际量化性能的实验验证**

为实证几何特性对量化的影响，设计如下实验：

1. **数据收集**：对Llama-3-8B的每个线性层，用固定校准集计算基矩阵$B = sX$；
2. **几何指标计算**：计算$B$的条件数$\kappa(B)$（基正交性 proxy）；
3. **量化误差测量**：用GPTQ将层权重量化至4bit，测量输出重构误差$MSE = ||XW - XQ||_F^2 / (n \cdot d)$；
4. **相关性分析**：绘制$\log(\kappa(B))$与$\log(MSE)$的散点图，预期呈现强正相关（相关系数>0.8）。

初步实验显示，注意力层的$\kappa(B)$普遍比前馈层高1-2个数量级，其$MSE$也相应更高，验证了格基几何质量对量化难度的预测能力。

## **第 7 节：理论整合与逻辑衔接**

上述对离群点几何结构与GPTQ格理论的分析，通过Hessian矩阵形成有机整体：流形结构的局部几何属性（如曲率、谱特征）由损失函数的Hessian矩阵捕获，而该Hessian恰恰定义了量化格的度量，为从抽象流形几何过渡到具体格投影问题提供了自然桥梁。

需特别说明的是：

- 格的维度描述需修正为“GPTQ的格定义于输出激活空间的$c$维子空间中”（而非完整的$n$维空间），以准确反映QR分解后的实际操作维度；
- 格基约减算法（如LLL）可视为量化前的**几何正则化**手段，其核心目标是通过优化基的正交性来最小化Babai误差的可证明上界，这为改进量化算法提供了明确的优化方向。

这一整合框架不仅解释了现有方法的局限（如无差别保护离群点导致的精度-隐私冲突），更指明了突破路径：通过几何感知的差异化量化，对主功能流形采用高精度投影，对离岛区域施加隐私保护的噪声投影，最终实现可控的精度-隐私权衡。
